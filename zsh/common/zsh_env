
# precedence is left to right, so paths on the left have higher priority

#
# Editors
#

export EDITOR='vim'
export VISUAL='vim'
export PAGER='less'

#
# Language
#

if [[ -z "$LANG" ]]; then
  export LANG='en_US.UTF-8'
  export LC_ALL=$LANG
fi

#
# Paths
#

export DOTFILES="$HOME/dotfiles"

# Set the list of directories that cd searches.
# cdpath=(
#   $cdpath
# )

# Set the list of directories that Zsh searches for programs.
path=(
  $HOME/bin2
  $HOME/.local/bin
  $HOME/dotfiles/bin
  /opt/local/{bin,sbin}
  /usr/local/{bin,sbin}
  /usr/{bin,sbin}
  $path
)

# Set the list of dirs that Zsh searches for man pages
manpath=(
  $HOME/bin2/man
  $HOME/.local/share/man
  $(manpath -g)
)

# Ensure path arrays do not contain duplicates.
typeset -gU cdpath fpath mailpath path manpath

# XDG Base Directory Spec env vars as per freedesktop.org project
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CACHE_HOME="$HOME/.cache"

#
# Less
#

# Set the default Less options.
# Mouse-wheel scrolling has been disabled by -X (disable screen clearing).
# Remove -X and -F (exit if the content fits on one screen) to enable it.
export LESS="-g -i -M -R -S -w -z-4"

# Set the Less input preprocessor.
# Try both `lesspipe` and `lesspipe.sh` as either might exist on a system.
if (( $#commands[(i)lesspipe(|.sh)] )); then
  export LESSOPEN="| /usr/bin/env $commands[(i)lesspipe(|.sh)] %s 2>&-"
fi

#
# LC
#

# setting sort order preference
if [[ "$(uname -s)" == 'Linux' ]]; then
  export LC_COLLATE=en_US.utf8
fi

#
# Environments
# NOTE: Only PATH/env-var setup here (fast). Shell integrations (eval "$(X init -)")
# are lazy-loaded in zsh_env_interactive to avoid ~1s overhead in every shell.
#

# pyenv - add shims to PATH statically (replaces slow `eval "$(pyenv init --path)"`)
if [[ -d $HOME/.pyenv ]]; then
  export PYENV_ROOT="$HOME/.pyenv"
  export PATH="$PYENV_ROOT/bin:$PYENV_ROOT/shims:$PATH"
  alias pyenv='nocorrect pyenv'
fi

# java (jenv) - bin + shims in PATH; shell integration is lazy-loaded in zsh_env_interactive
# shims provide java/javac/jar/etc. immediately (same pattern as pyenv shims)
if [[ -d $HOME/.jenv ]]; then
  export PATH="$HOME/.jenv/bin:$HOME/.jenv/shims:$PATH"
fi

# maven
export PATH="$HOME/bin2/maven/bin:$PATH"

# golang
# look for goenv first
if [[ -d $HOME/.goenv ]]; then
  export GOENV_ROOT="$HOME/.goenv"
  # bin: goenv binary; shims: go/gofmt/etc. routed through goenv (same pattern as pyenv/jenv)
  export PATH="$GOENV_ROOT/bin:$GOENV_ROOT/shims:$PATH"
  # goenv init sets GOROOT/GOPATH; we set a safe fallback for scripts
  export GOPATH="${GOPATH:-$HOME/.golang}"
  export PATH="$PATH:$GOPATH/bin"
# then look for system install
elif [[ -d /usr/local/go/bin ]]; then
  export PATH="/usr/local/go/bin:$PATH"
  export GOPATH="$HOME/.golang"
  export PATH="$GOPATH/bin:$PATH"
# then for custom userspace install
elif [[ -d $HOME/bin2/go/bin ]]; then
  export PATH="$HOME/bin2/go/bin:$PATH"
  export GOPATH="$HOME/.golang"
  export PATH="$GOPATH/bin:$PATH"
fi

# swift
# on macOS it is part of Xcode
if [[ "$(uname -s)" == 'Linux' ]] && [[ -d /opt/swift/usr/bin ]]; then
  export PATH=/opt/swift/usr/bin:$PATH
fi

# node.js / nvm - export NVM_DIR only; nvm.sh is lazy-loaded in zsh_env_interactive
if [[ -d "$HOME/.nvm" ]]; then
  export NVM_DIR="$HOME/.nvm"
fi

# rust
if [[ -d "$HOME/.cargo/bin" ]]; then
  export PATH="$HOME/.cargo/bin:$PATH"
fi

# krew
if [[ -d "${KREW_ROOT:-$HOME/.krew}/bin" ]]; then
  export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"
fi

## WebAssembly -- start

# wasmer
export WASMER_DIR="$HOME/.wasmer"
[ -s "$WASMER_DIR/wasmer.sh" ] && source "$WASMER_DIR/wasmer.sh"

# wasmtime
if [[ -d "$HOME/.wasmtime" ]]; then
  export WASMTIME_HOME="$HOME/.wasmtime"
  export PATH="$WASMTIME_HOME/bin:$PATH"
fi

## WebAssembly -- end

# deno.land
if [[ -d "$HOME/.deno" ]]; then
  export DENO_INSTALL="$HOME/.deno"
  export PATH="$DENO_INSTALL/bin:$PATH"
fi

# serverless framework
if [[ -d "$HOME/.serverless/bin" ]]; then
  export PATH="$HOME/.serverless/bin:$PATH"
fi

# pnpm package manager
if [[ -d "$HOME/.local/share/pnpm" ]]; then
  export PNPM_HOME="$HOME/.local/share/pnpm"
  export PATH="$PNPM_HOME:$PATH"
fi

# Bun JS runtime and toolkit
if [[ -d "$HOME/.bun" ]]; then
  export BUN_INSTALL="$HOME/.bun"
  export PATH="$BUN_INSTALL/bin:$PATH"
fi

# terraform (tfenv)
export PATH="$HOME/.tfenv/bin:$PATH"

# ruby / rvm - PATH only; rvm shell integration is lazy-loaded in zsh_env_interactive
if [[ -d "$HOME/.rvm" ]]; then
  export PATH="$PATH:$HOME/.rvm/bin"
fi

# poof init
if [[ "$(uname -s)" == 'Darwin' ]]; then
  export POOF_ROOT="$HOME/Library/Application Support/poof"
elif [[ "$(uname -s)" == 'Linux' ]]; then
  export POOF_ROOT="$HOME/.local/share/poof"
fi
export PATH="$POOF_ROOT/bin:$PATH"
